##############################################################################
# makefile
#
# University of Minnesota 
# Aerospace Engineering and Mechanics 
# Copyright 2011 Regents of the University of Minnesota. All rights reserved.
#
# $Id: Makefile 777 2012-02-23 16:58:44Z murch $
# 
##############################################################################

##### SOFTWARE CONFIGURATION #####

##### AIRCRAFT SELECTION #####
# Select the desired aircraft configuration file here
AIRCRAFT = HASP

##### GUIDANCE LAW #####
# Point to the desired guidance code here
GUIDANCE = guidance/straight_level.c

##### NAVIGATION #####
# Point to the desired navigation code here
NAVIGATION = navigation/EKF_15state.c

##### FLIGHT CONTROL LAW #####
# Point to the desired flight control law code here
CONTROL = control/empty_control.c

##### MATLAB RTW AUTOCODE #####
# Make sure #include "simstruc.h" and #include "fixedpoint.h" are commented out in the <modelname>.h file
# Specify the path to the autogenerated code, e.g. /<modelname>_grt_rtw/
#RTW_ROOT = ../../Simulation/SIL_sim/baseline_control_grt_rtw/
RTW_ROOT = 

# Specify the main code to be compiled <modelname>.c, along with any utility source files
#CONTROL = $(RTW_ROOT)baseline_control.c \
#$(RTW_ROOT)rtGetInf.c \
#$(RTW_ROOT)rtGetNaN.c \
#$(RTW_ROOT)rt_nonfinite.c 

#### Determine which aircraft config file, data logging, actuator, and sensor files to compile
ifeq ($(strip $(AIRCRAFT)),HASP)
AIRCRAFT_CONFIG = aircraft/HASP_config.h
DATALOG_CONFIG = datalog/HASP_datalog.h
SENSORS = sensors/GPS/gps_novatel.c sensors/IMU/IMU_iSensor.c sensors/GPIO/gpio.c 
ACTUATORS = actuators/actuator_PWM.c
endif
#########################################################################

# Code to be compiled
OBJ =\
utils/serial_mpc5200.c \
utils/matrix.c \
utils/misc.c \
utils/scheduling.c \
utils/I2C/hasp_i2c_mpc5xxx.c\
control/control_functions.c \
navigation/nav_functions.c \
telemetry/telemetry.c \
datalog/datalogger.c \
sensors/daq.c \
$(GUIDANCE) \
$(NAVIGATION) \
$(CONTROL) \
$(SENSORS) \
$(ACTUATORS) \
threads/thread1.c\
threads/threads.c\
main.c 


##### DIRECTORY SETUP #################################################
# Edit this section to set paths for your computer

##### MATLAB RTW ######################################################
# Path to your MATLAB directory for RTW files. 
# Cannot have any spaces in the names!
# Use /cygdrive/c/ instead of C:/
#MATLAB_ROOT = /cygdrive/c/PROGRA~2/MATLAB/R2010a

#MATLAB_INCLUDES = \
#	-I$(MATLAB_ROOT)/simulink/include \
#	-I$(MATLAB_ROOT)/extern/include \
#	-I$(MATLAB_ROOT)/rtw/c/src 

MATLAB_INCLUDES = -I

##### MPC 5200 PARAMETERS ###############################################
# eCos PowerPC files. Should be located in the cygwin folder
CC=/opt/ecos/gnutools/powerpc-eabi/bin/powerpc-eabi-gcc-4.3.2
#CP=/opt/ecos/gnutools/powerpc-eabi/bin/powerpc-eabi-objcopy
#OD=/opt/ecos/gnutools/powerpc-eabi/bin/powerpc-eabi-objdump

# Uncomment the following two lines if these variables are not set in your cygwin .bash_profile or you use Eclipse IDE
# You may also need to edit the path to point to the appropriate directory.
ECOS_LIB_PATH_MPC5200="C:\cygwin\home\Minnesat\eCos\build\lib"
ECOS_INCLUDE_PATH_MPC5200="C:\cygwin\home\Minnesat\eCos\build\include"
##########################################################################

CFLAGS=-g -O2 -Wall -mcpu=603e -I$(ECOS_INCLUDE_PATH_MPC5200) $(MATLAB_INCLUDES) -I$(RTW_ROOT)
LFLAGS	=-Wl,--gc-sections -Wl,-static -Ttarget.ld -nostdlib -L$(ECOS_LIB_PATH_MPC5200) -Lsrc -D'AIRCRAFT="$(AIRCRAFT_CONFIG)"' -D'AIRCRAFT_UP1DIR="../$(AIRCRAFT_CONFIG)"' -D'DATALOG_CONFIG="$(DATALOG_CONFIG)"'

#### RULES ####
all: clean output display

output: $(OBJ)
	@ echo "Building..."	
	$(CC) -o $@ $^ $(LFLAGS) $(CFLAGS)
		
clean:
	-rm output

display: 
	@ echo
	@ echo "#################### UMN UAV Software ######################"
	@ echo "Successful build with the following configuration:"
	@ echo "AIRCRAFT = $(AIRCRAFT_CONFIG)"
	@ echo "DATALOG = $(DATALOG_CONFIG)"
	@ echo "GUIDANCE = $(GUIDANCE)"
	@ echo "NAVIGATION = $(NAVIGATION)"
	@ echo "CONTROL = $(CONTROL)"
	@ echo ""
	@ echo "University of Minnesota"
	@ echo "Aerospace Engineering and Mechanics"
	@ echo "Copyright 2011 Regents of the University of Minnesota. All rights reserved."
	@ echo "www.uav.aem.umn.edu"
	
	
	
	
